var scr=document.getElementsByTagName("script"),zoombox_path=scr[scr.length-1].getAttribute("src").replace("zoombox.js","");!function(l){var r,s,c,i,a,t,n,d={theme:"zoombox",opacity:.8,duration:800,animation:!0,width:600,height:400,gallery:!0,autoplay:!1,overflow:!1},m=!1,h=0,b="multimedia",x=!1,p=!1,z="closed",u='<div id="zoombox">             <div class="zoombox_mask"></div>            <div class="zoombox_container">                <div class="zoombox_content"></div>                <div class="zoombox_title"></div>                <div class="zoombox_next"></div>                <div class="zoombox_prev"></div>                <div class="zoombox_close"></div>            </div>            <div class="zoombox_gallery"></div>        </div>',w=/(\.jpg)|(\.jpeg)|(\.bmp)|(\.gif)|(\.png)/i,g=/(\.mp3)/i,f=/(\.flv)/i,v=/(\.swf)/i,y=/(\.mov)|(\.mp4)/i,_=/(\.wmv)|(\.avi)/i,k=/(http:\/\/www.dailymotion)|(http:\/\/dailymotion)/i,T=/(http:\/\/www.vimeo)|(http:\/\/vimeo)/i,j=/(youtube\.)/i,C=/(http:\/\/www\.koreus)|(http:\/\/koreus)/i;function I(){var o,e;"closed"==z&&(m=!1),z="load",i=d.width,a=d.height,null!=s&&(null!=(o=/w([0-9]+)/.exec(s.attr("class")))&&o[1]&&(i=o[1]),null!=(e=/h([0-9]+)/.exec(s.attr("class")))&&e[1]&&(a=e[1])),w.test(c)?(img=new Image,img.src=c,l("body").append('<div id="zoombox_loader"></div>'),l("#zoombox_loader").css("marginTop",W()),t=window.setInterval(function(){var o;(o=img).complete&&(h=0,window.clearInterval(t),i=o.width,a=o.height,l("#zoombox_loader").remove(),F(),E()),l("#zoombox_loader").css({"background-position":"0px "+h+"px"}),(h-=40)<-440&&(h=0)},100)):(F(),E())}function O(){var i=0;if(d.gallery){if(!1===p)return l("#zoombox .zoombox_gallery").remove(),0;for(var o in p){var e=zoombox_path+"img/video.png",t=l('<img src="'+e+'" class="video gallery'+ +o+'"/>');w.test(p[o].attr("href"))&&(e=p[o].attr("href"),t=l('<img src="'+e+'" class="gallery'+ +o+'"/>')),t.data("id",o).appendTo("#zoombox .zoombox_gallery"),t.click(function(){M(l(this).data("id")),l("#zoombox .zoombox_gallery img").removeClass("current"),l(this).addClass("current")}),o==x&&t.addClass("current"),l("<img/>").data("img",t).attr("src",e).load(function(){i++;var o,e,t=l(this).data("img");t.width(Math.round(t.height()*this.width/this.height)),i==l("#zoombox .zoombox_gallery img").length&&(o=0,l("#zoombox .zoombox_gallery img").each(function(){o+=l(this).outerWidth(),l(this).data("left",o)}),e=l("<div>").css({position:"absolute",top:0,left:0,width:o}),l("#zoombox .zoombox_gallery").wrapInner(e),l("#zoombox .zoombox_gallery").width(),l("#zoombox").trigger("change"))})}l("#zoombox .zoombox_gallery").show().animate({bottom:0},d.duration)}l("#zoombox").bind("change",function(o,e){if(l("#zoombox .zoombox_gallery div").width()<l("#zoombox .zoombox_gallery").width)return!0;var t=0,i=null!=e?(t=d.duration,e.width/2):l("#zoombox .zoombox_gallery").width()/2,a=-l("#zoombox .zoombox_gallery img.current").data("left")+l("#zoombox .zoombox_gallery img.current").width()/2+i;a<2*i-l("#zoombox .zoombox_gallery div").width()&&(a=2*i-l("#zoombox .zoombox_gallery div").width()),0<a&&(a=0),l("#zoombox .zoombox_gallery div").animate({left:a},t)})}function E(){var o;0==m?(l("body").append(u),l(window).keydown(function(o){var e;37==(e=o.which)&&H(),39==e&&A(),27==e&&Y()}),l(window).resize(function(){l("#zoombox .zoombox_container").css({top:(P()-l("#zoombox .zoombox_container").outerHeight(!0))/2,left:(S()-l("#zoombox .zoombox_container").outerWidth(!0))/2})}),l("#zoombox .zoombox_mask").hide(),l("#zoombox").addClass(d.theme),l("#zoombox .zoombox_mask,.zoombox_close").click(function(){return Y(),!1}),0==p?l("#zoombox .zoombox_next,#zoombox .zoombox_prev").remove():(l("#zoombox .zoombox_next").click(function(){A()}),l("#zoombox .zoombox_prev").click(function(){H()}))):l("#zoombox .zoombox_title").empty(),l("#zoombox .close").hide(),l("#zoombox .zoombox_container").removeClass("multimedia").removeClass("img").addClass(b),null!=s&&s.attr("title")&&l("#zoombox .zoombox_title").append(s.attr("title")),l("#zoombox .zoombox_content").empty(),"img"==b&&0==m&&1==d.animation&&l("#zoombox .zoombox_content").append(n),null!=s&&0!=s.find("img").length&&0==m?(o=s.find("img"),l("#zoombox .zoombox_container").css({width:o.width(),height:o.height(),top:o.offset().top,left:o.offset().left,opacity:0,marginTop:o.css("marginTop")})):null!=s&&0==m?l("#zoombox .zoombox_container").css({width:s.width(),height:s.height(),top:s.offset().top,left:s.offset().left}):0==m&&l("#zoombox .zoombox_container").css({width:100,height:100,top:P()/2-50,left:S()/2-50});var e={width:i,height:a,left:(S()-i)/2,top:(P()-a)/2,marginTop:W(),opacity:1};l("#zoombox").trigger("change",e),1==d.animation?(l("#zoombox .zoombox_title").hide(),l("#zoombox .zoombox_close").hide(),l("#zoombox .zoombox_container").animate(e,d.duration,function(){"multimedia"!=b&&1!=m||l("#zoombox .zoombox_content").append(n),"image"!=b&&1!=m||l("#zoombox .zoombox_content img").css("opacity",0).fadeTo(300,1),l("#zoombox .zoombox_title").fadeIn(300),l("#zoombox .zoombox_close").fadeIn(300),z="opened",m||O(),m=!0}),l("#zoombox .zoombox_mask").fadeTo(200,d.opacity)):(l("#zoombox .zoombox_content").append(n),l("#zoombox .zoombox_close").show(),l("#zoombox .zoombox_gallery").show(),l("#zoombox .zoombox_container").css(e),l("#zoombox .zoombox_mask").show(),l("#zoombox .zoombox_mask").css("opacity",d.opacity),m||O(),m=!0,z="opened")}function Y(){z="closing",window.clearInterval(t),l(window).unbind("keydown"),l(window).unbind("resize"),"multimedia"==b&&l("#zoombox .zoombox_container").empty();var o,e=null!=s&&0<s.find("img").length?{width:(o=s.find("img")).width(),height:o.height(),top:o.offset().top,left:o.offset().left,opacity:0,marginTop:o.css("marginTop")}:null!=s?{width:s.width(),height:s.height(),top:s.offset().top,left:s.offset().left,marginTop:0,opacity:0}:{width:100,height:100,top:P()/2-50,left:S()/2-50,opacity:0};1==d.animation?(l("#zoombox .zoombox_mask").fadeOut(200),l("#zoombox .zoombox_gallery").animate({bottom:-l("#zoombox .zoombox_gallery").innerHeight()},d.duration),l("#zoombox .zoombox_container").animate(e,d.duration,function(){l("#zoombox").remove(),m=!(z="closed")})):(l("#zoombox").remove(),m=!(z="closed"))}function F(){0==d.overflow&&(+i+50>S()&&(a=(S()-50)*a/i,i=S()-50),+a+50>P()&&(i=(P()-50)*i/a,a=P()-50));var o,e,t=c;return b="multimedia",w.test(t)?(b="img",n='<img src="'+c+'" width="100%" height="100%"/>'):g.test(t)?(i=300,a=40,n='<object type="application/x-shockwave-flash" data="'+MP3Player+"?son="+t+'" width="'+i+'" height="'+a+'">',n+='<param name="movie" value="'+MP3Player+"?son="+t+'" /></object>'):n=f.test(t)?(o=0,1==d.autoplay&&(o=1),'<object type="application/x-shockwave-flash" data="'+zoombox_path+'FLVplayer.swf" width="'+i+'" height="'+a+'"><param name="allowFullScreen" value="true"><param name="scale" value="noscale"><param name="wmode" value="transparent"><param name="flashvars" value="flv='+t+"&autoplay="+o+'"><embed src="'+zoombox_path+'FLVplayer.swf" width="'+i+'" height="'+a+'" allowscriptaccess="always" allowfullscreen="true" flashvars="flv='+t+'" wmode="transparent" /></object>'):v.test(t)?'<object width="'+i+'" height="'+a+'"><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="'+t+'" /><embed src="'+t+'" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="'+i+'" height="'+a+'" wmode="transparent"></embed></object>':y.test(t)?'<embed src="'+t+'" width="'+i+'" height="'+a+'" controller="true" cache="true" autoplay="true"/>':_.test(t)?'<embed src="'+t+'" width="'+i+'" height="'+a+'" controller="true" cache="true" autoplay="true" wmode="transparent" />':k.test(t)?(e=(e=(e=t.split("_"))[0].split("/"))[e.length-1]+"?",1==d.autoplay&&(e+="autoPlay=1&"),'<iframe frameborder="0" width="'+i+'" height="'+a+'" src="http://www.dailymotion.com/embed/video/'+e+'?wmode=transparent"></iframe>'):T.test(t)?(e=(e=t.split("/"))[3]+"?",1==d.autoplay&&(e+="autoplay=1&"),'<iframe src="http://player.vimeo.com/video/'+e+'title=0&amp;byline=0&amp;portrait=0&amp;wmode=transparent" width="'+i+'" height="'+a+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'):j.test(t)?(e=(e=(e=t.split("watch?v="))[1].split("&"))[0]+"?",1==d.autoplay&&(e+="autoplay=1&"),'<iframe width="'+i+'" height="'+a+'" src="http://www.youtube.com/embed/'+e+'wmode=Opaque" frameborder="0" allowfullscreen></iframe>'):C.test(t)?'<object type="application/x-shockwave-flash" data="'+(t=(t=t.split(".html"))[0])+'" width="'+i+'" height="'+a+'"><param name="movie" value="'+t+'"><embed src="'+t+'" type="application/x-shockwave-flash" width="'+i+'" height="'+a+'"  wmode="transparent"></embed></object>':'<iframe src="'+t+'" width="'+i+'" height="'+a+'" border="0"></iframe>',n}function M(o){return"opened"==z&&(s=p[x=o],c=s.attr("href"),0<l("#zoombox .zoombox_gallery img").length&&(l("#zoombox .zoombox_gallery img").removeClass("current"),l("#zoombox .zoombox_gallery img:eq("+o+")").addClass("current")),I(),!1)}function A(){(h=x+1)>p.length-1&&(h=0),M(h)}function H(){(h=x-1)<0&&(h=p.length-1),M(h)}function P(){return window.innerHeight?window.innerHeight:l(window).height()}function S(){return window.innerWidth?window.innerWidth:l(window).width()}function W(){return scrOfY=0,"number"==typeof window.pageYOffset?scrOfY=window.pageYOffset:document.body&&document.body.scrollTop?scrOfY=document.body.scrollTop:document.documentElement&&document.documentElement.scrollTop&&(scrOfY=document.documentElement.scrollTop),scrOfY}l.zoombox=function(o,e){},l.zoombox.options=d,l.zoombox.close=function(){Y()},l.zoombox.open=function(o,e){s=null,c=o,d=l.extend({},l.zoombox.options,e),I()},l.zoombox.html=function(o,e){n=o,d=l.extend({},l.zoombox.options,e),i=d.width,a=d.height,s=null,E()},l.fn.zoombox=function(m){return r=new Array,this.each(function(){var o,e=-1;if("Microsoft Internet Explorer"==navigator.appName&&(o=navigator.userAgent,null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(o)&&(e=parseFloat(RegExp.$1))),1==(-1<e&&!(8<=e))&&!window.XMLHttpRequest)return!1;var t,i=this,a=/zgallery([0-9]+)/.exec(l(this).attr("class")),n=!1;null!=a&&(r[a[1]]||(r[a[1]]=new Array),r[a[1]].push(l(this)),t=r[a[1]].length-1,n=r[a[1]]),l(this).unbind("click").click(function(){return d=l.extend({},l.zoombox.options,m),"closed"==z&&(s=l(i),c=s.attr("href"),p=n,x=t,I(),!1)})})}}(jQuery);
